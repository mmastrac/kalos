"idl {\n"
"    prefix \"kalos_module_idl_\";\n"
"    dispatch name;\n"
"\n"
"    module builtin {\n"
"        fn println(s: string) = kalos_idl_compiler_println;\n"
"        fn print(s: string) = kalos_idl_compiler_print;\n"
"        fn log(s: string) = kalos_idl_compiler_log;\n"
"\n"
"        # Old handlers\n"
"        handler close;\n"
"        handler open(flags: number);\n"
"    }\n"
"\n"
"    module sys {\n"
"        prop args: object { read = kalos_sys_get_args; }\n"
"        fn env(s: string): string = kalos_sys_get_env;\n"
"        fn exit(n: number) = c \"exit(@0)\";\n"
"        handler main(args: object);\n"
"    }\n"
"\n"
"    module file {\n"
"        const READ: number = 1;\n"
"        const WRITE: number = 2;\n"
"        const READ_WRITE: number = 3;\n"
"        const CREATE: number = 4;\n"
"        const TRUNCATE: number = 8;\n"
"        const APPEND: number = 16;\n"
"\n"
"        fn open(s: string, mode: number): object = kalos_file_open;\n"
"        fn readline(file: object): string = kalos_file_readline;\n"
"        fn read {\n"
"            (file: object): string = kalos_file_read_all;\n"
"            (file: object, size: number): string = kalos_file_read;\n"
"        }\n"
"        fn write(file: object, s: string) = kalos_file_write;\n"
"        fn close(file: object) = kalos_file_close;\n"
"\n"
"        prop stdin: object { read = kalos_file_get_stdin; }\n"
"        prop stdout: object { read = kalos_file_get_stdout; }\n"
"        prop stderr: object { read = kalos_file_get_stderr; }\n"
"    }\n"
"\n"
"    module kalos {\n"
"        fn compile_script(modules: object, script: string): object = kalos_compiler_compile_script;\n"
"        fn compile_idl(script: string): object = kalos_compiler_compile_idl;\n"
"\n"
"        object idl {\n"
"            prop data: string { read = kalos_compiler_get_buffer; }\n"
"        }\n"
"\n"
"        object script {\n"
"            prop data: string { read = kalos_compiler_get_buffer; }\n"
"        }\n"
"    }\n"
"\n"
"    module kidl {\n"
"        fn walk_modules(context: any) = kalos_idl_walk_modules;\n"
"        prop prefix: string { read = kalos_idl_module_prefix; }\n"
"    }\n"
"\n"
"    module module {\n"
"        fn walk_exports(context: any) = kalos_idl_walk_exports;\n"
"        fn walk_object_properties(context: any, object: object) = kalos_idl_walk_object_properties;\n"
"\n"
"        handler begin(context: any, module: object);\n"
"        handler function(context: any, function: object);\n"
"        handler handler(context: any, handler: object);\n"
"        handler property(context: any, property: object);\n"
"        handler object(context: any, property: object);\n"
"\n"
"        object module_obj {\n"
"            prop name: string { read = c \"IDL_STRING(IDL_OBJECT(kalos_module)->name_index)\"; }\n"
"        }\n"
"\n"
"        object function_obj {\n"
"            prop name: string { read = kalos_idl_export_name; }\n"
"            prop overloads: object { read = kalos_idl_function_overloads; }\n"
"        }\n"
"\n"
"        object overload_obj {\n"
"            prop return_type: string { read = kalos_idl_overload_return_type; }\n"
"            prop args: object { read = kalos_idl_overload_args; }\n"
"            prop arg_count: number { read = kalos_idl_overload_arg_count; }\n"
"            prop varargs: string { read = kalos_idl_overload_varargs; }\n"
"            prop binding: object { read = kalos_idl_overload_binding; }\n"
"        }\n"
"\n"
"        object property_obj {\n"
"            prop name: string { read = kalos_idl_property_name; }\n"
"            prop type: string { read = kalos_idl_property_type; }\n"
"            prop read_binding: object { read = kalos_idl_property_read_binding; }\n"
"            prop write_binding: object { read = kalos_idl_property_write_binding; }\n"
"        }\n"
"\n"
"        object handler_obj {\n"
"            prop name: string { read = kalos_idl_export_name; }\n"
"            prop module_index: number { read = kalos_idl_handler_module_index; }\n"
"            prop handler_index: number { read = kalos_idl_handler_index; }\n"
"            prop args: object { read = kalos_idl_handler_args; }\n"
"        }\n"
"\n"
"        object object_obj {\n"
"            prop name: string { read = kalos_idl_export_name; }\n"
"        }\n"
"\n"
"        object binding_obj {\n"
"            prop type: string { read = kalos_idl_binding_type; }\n"
"            prop value: string { read = kalos_idl_binding_value; }\n"
"            prop invoke_id: number { read = c \"IDL_OBJECT(kalos_binding)->invoke_id\"; }\n"
"        }\n"
"    }\n"
"}\n"
""
